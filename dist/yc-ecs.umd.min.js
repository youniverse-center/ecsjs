!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).YcsEcs={})}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}var i=function(){function e(n,o){t(this,e),this.entityId=n,this.registry=o}return o(e,[{key:"id",get:function(){return this.entityId}},{key:"components",value:function(){return this.registry.getComponents(this.entityId)}},{key:"hasComponent",value:function(e){return this.registry.hasComponent(this.entityId,e)}},{key:"addComponent",value:function(e,t){return this.registry.assignComponent(this.entityId,e,t)}},{key:"removeComponent",value:function(e){this.registry.removeComponent(this.entityId,e)}},{key:"getComponent",value:function(e){return this.registry.getComponent(this.entityId,e)}}]),e}(),r=function(){function e(n,o){t(this,e),this.resultMap=new Map,this.groupAll=n,this.groupAny=o}return o(e,[{key:"addComponent",value:function(e,t,n){var o=this.resultMap.get(e);o||(o=new Map,this.resultMap.set(e,o)),o.set(t,n)}},{key:"result",get:function(){var e=[];return this.resultMap.forEach((function(t,n){e.push({entity:n,component:function(e){return t.get(e)},hasComponent:function(e){return t.has(e)}})})),e}}]),e}(),s=function(e,t){return!t.length||t.includes(e)},u=function(){function e(){t(this,e),this.entityComponents=new Map,this.components=new Map,this.nextEntity=1,this.listeners={componentAdded:[],componentRemoved:[],entityCreated:[],entityRemoved:[]}}return o(e,[{key:"getComponentMap",value:function(e){return this.components.has(e)||this.components.set(e,new Map),this.components.get(e)}},{key:"createEntity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new i(this.nextEntity,this);for(var n in this.nextEntity+=1,this.entityComponents.set(t.id,new Set),this.listeners.entityCreated.forEach((function(e){e(t)})),e)Object.prototype.hasOwnProperty.call(e,n)&&t.addComponent(n,e[n]);return t}},{key:"getEntity",value:function(e){return new i(e,this)}},{key:"getComponents",value:function(e){var t=this.entityComponents.get(e);return t?Array.from(t):[]}},{key:"hasComponent",value:function(e,t){return this.getComponentMap(t).has(e)}},{key:"assignComponent",value:function(e,t,n){var o=this,r=this.entityComponents.get(e);return r&&(r.add(t),this.getComponentMap(t).set(e,n)),this.listeners.componentAdded.filter((function(e){return s(t,e.filter)})).forEach((function(r){r.handler(new i(e,o),t,n)})),n}},{key:"removeComponent",value:function(e,t){var n=this,o=this.entityComponents.get(e);if(o){var r=this.getComponent(e,t);this.listeners.componentRemoved.filter((function(e){return s(t,e.filter)})).forEach((function(o){o.handler(new i(e,n),t,r)})),o.delete(t)}this.getComponentMap(t).delete(e)}},{key:"getComponent",value:function(e,t){var n=this.getComponentMap(t).get(e);if(!n)throw new Error("Entity ".concat(e," does not have component ").concat(t));return n}},{key:"removeEntity",value:function(e){var t=this,n=this.entityComponents.get(e);n&&(this.listeners.entityRemoved.forEach((function(n){n(new i(e,t))})),n.forEach((function(n){t.removeComponent(e,n)})),this.entityComponents.delete(e))}},{key:"getView",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=new r(e,n);return this.entityComponents.forEach((function(r,s){var u=Array.from(r),a=e.filter((function(e){return u.includes(e)}));if(a.length===e.length){var f=new i(s,t);n.filter((function(e){return u.includes(e)})).concat(a).forEach((function(e){var n=t.getComponent(s,e);n&&o.addComponent(f,e,n)}))}})),o}},{key:"all",value:function(){var e=this;return Array.from(this.entityComponents.keys()).map((function(t){return new i(t,e)}))}},{key:"onComponentAdded",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.listeners.componentAdded.push({filter:t,handler:e})}},{key:"offComponentAdded",value:function(e){this.listeners.componentAdded=this.listeners.componentRemoved.filter((function(t){return t.handler!==e}))}},{key:"onComponentRemoved",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.listeners.componentRemoved.push({filter:t,handler:e})}},{key:"offComponentRemoved",value:function(e){this.listeners.componentRemoved=this.listeners.componentRemoved.filter((function(t){return t.handler!==e}))}},{key:"onEntityCreated",value:function(e){this.listeners.entityCreated.push(e)}},{key:"offEntityCreated",value:function(e){this.listeners.entityCreated=this.listeners.entityCreated.filter((function(t){return t!==e}))}},{key:"onEntityRemoved",value:function(e){this.listeners.entityRemoved.push(e)}},{key:"offEntityRemoved",value:function(e){this.listeners.entityRemoved=this.listeners.entityRemoved.filter((function(t){return t!==e}))}}]),e}(),a=function(){return new u};e.createRegistry=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=yc-ecs.umd.min.js.map
