!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).YcsEcs={})}(this,(function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function o(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var o,i,r=[],s=!0,u=!1;try{for(n=n.call(t);!(s=(o=n.next()).done)&&(r.push(o.value),!e||r.length!==e);s=!0);}catch(t){u=!0,i=t}finally{try{s||null==n.return||n.return()}finally{if(u)throw i}}return r}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var a=function(){function t(n,o){e(this,t),this.entityId=n,this.registry=o}return o(t,[{key:"id",get:function(){return this.entityId}},{key:"components",value:function(){return this.registry.getComponents(this.entityId)}},{key:"hasComponent",value:function(t){return this.registry.hasComponent(this.entityId,t)}},{key:"addComponent",value:function(t,e){return this.registry.assignComponent(this.entityId,t,e)}},{key:"removeComponent",value:function(t){this.registry.removeComponent(this.entityId,t)}},{key:"getComponent",value:function(t){return this.registry.getComponent(this.entityId,t)}}]),t}(),l=function(){function t(n,o){e(this,t),this.resultMap=new Map,this.groupAll=n,this.groupAny=o}return o(t,[{key:"test",value:function(t){var e=t.components();return this.groupAll.filter((function(t){return e.includes(t)})).length===this.groupAll.length}},{key:"addEntity",value:function(t){var e=new Map;this.resultMap.set(t.id,{entity:t,componentMap:e}),[].concat(r(this.groupAll),r(this.groupAny)).forEach((function(n){t.hasComponent(n)&&e.set(n,t.getComponent(n))}))}},{key:"hasEntity",value:function(t){return this.resultMap.has(t.id)}},{key:"result",get:function(){var t=[];return this.resultMap.forEach((function(e){var n=e.componentMap;t.push({entity:e.entity,component:function(t){return n.get(t)},hasComponent:function(t){return n.has(t)}})})),t}}]),t}(),h=function(t,e){return!e.length||e.includes(t)},f=function(){function t(){e(this,t),this.entityComponents=new Map,this.components=new Map,this.nextEntity=1,this.listeners={afterComponentRemoved:[],componentAdded:[],componentRemoved:[],entityCreated:[],entityRemoved:[]}}return o(t,[{key:"getComponentMap",value:function(t){return this.components.has(t)||this.components.set(t,new Map),this.components.get(t)}},{key:"createEntity",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new a(this.nextEntity,this);this.nextEntity+=1,this.entityComponents.set(e.id,new Set),this.listeners.entityCreated.forEach((function(t){t(e)}));var n=Object.entries(t);return n.forEach((function(t){var n=i(t,2),o=n[0],r=n[1];e.addComponent(o,r)})),e}},{key:"getEntity",value:function(t){if(!this.entityComponents.has(t))throw new Error("Entity ".concat(t," not found"));return new a(t,this)}},{key:"getComponents",value:function(t){var e=this.entityComponents.get(t);return e?Array.from(e):[]}},{key:"hasComponent",value:function(t,e){return this.getComponentMap(e).has(t)}},{key:"assignComponent",value:function(t,e,n){var o=this,i=this.entityComponents.get(t);if(!i)throw new Error("Entity ".concat(t," not found"));return i.add(e),this.getComponentMap(e).set(t,n),this.listeners.componentAdded.filter((function(t){return h(e,t.filter)})).forEach((function(i){i.handler(new a(t,o),e,n)})),n}},{key:"removeComponent",value:function(t,e){var n=this,o=this.entityComponents.get(t);if(!o)throw new Error("Entity ".concat(t," not found"));var i=this.getComponent(t,e);this.listeners.componentRemoved.filter((function(t){return h(e,t.filter)})).forEach((function(o){o.handler(new a(t,n),e,i)})),o.delete(e),this.getComponentMap(e).delete(t),this.listeners.afterComponentRemoved.filter((function(t){return h(e,t.filter)})).forEach((function(o){o.handler(new a(t,n),e,i)}))}},{key:"getComponent",value:function(t,e){var n=this.getComponentMap(e).get(t);if(!n)throw new Error("Entity ".concat(t," does not have component ").concat(String(e)));return n}},{key:"removeEntity",value:function(t){var e=this,n=this.entityComponents.get(t);n&&(this.listeners.entityRemoved.forEach((function(n){n(new a(t,e))})),n.forEach((function(n){e.removeComponent(t,n)})),this.entityComponents.delete(t))}},{key:"getView",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=new l(t,e);return this.all().filter((function(t){return n.test(t)})).forEach((function(t){n.addEntity(t)})),n}},{key:"all",value:function(){var t=this;return Array.from(this.entityComponents.keys()).map((function(e){return new a(e,t)}))}},{key:"onAfterComponentRemoved",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.listeners.afterComponentRemoved.push({filter:e,handler:t})}},{key:"offAfterComponentRemoved",value:function(t){this.listeners.afterComponentRemoved=this.listeners.afterComponentRemoved.filter((function(e){return e.handler!==t}))}},{key:"onComponentAdded",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.listeners.componentAdded.push({filter:e,handler:t})}},{key:"offComponentAdded",value:function(t){this.listeners.componentAdded=this.listeners.componentAdded.filter((function(e){return e.handler!==t}))}},{key:"onComponentRemoved",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.listeners.componentRemoved.push({filter:e,handler:t})}},{key:"offComponentRemoved",value:function(t){this.listeners.componentRemoved=this.listeners.componentRemoved.filter((function(e){return e.handler!==t}))}},{key:"onEntityCreated",value:function(t){this.listeners.entityCreated.push(t)}},{key:"offEntityCreated",value:function(t){this.listeners.entityCreated=this.listeners.entityCreated.filter((function(e){return e!==t}))}},{key:"onEntityRemoved",value:function(t){this.listeners.entityRemoved.push(t)}},{key:"offEntityRemoved",value:function(t){this.listeners.entityRemoved=this.listeners.entityRemoved.filter((function(e){return e!==t}))}}]),t}(),c=function(){function t(n,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e(this,t),this.view=null,this.registry=n,this.requiredComponents=o,this.optionalComponents=i;var s=[].concat(r(this.requiredComponents),r(this.optionalComponents));this.registry.onComponentAdded(this.onEntityChanged.bind(this),s),this.registry.onAfterComponentRemoved(this.onEntityChanged.bind(this),s)}return o(t,[{key:"result",get:function(){return null===this.view&&this.rebuildView(),this.view.result}},{key:"invalidate",value:function(){this.view=null}},{key:"rebuildView",value:function(){this.view=this.registry.getView(this.requiredComponents,this.optionalComponents)}},{key:"onEntityChanged",value:function(t){if(null!==this.view){var e=this.requiredComponents.every((function(e){return t.hasComponent(e)}));(e&&!this.view.hasEntity(t)||!e&&this.view.hasEntity(t))&&this.invalidate()}}}]),t}();t.CacheableView=c,t.createRegistry=function(){return new f},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=yc-ecs.umd.min.js.map
